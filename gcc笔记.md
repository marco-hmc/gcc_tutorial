## gcc笔记

[toc]

> 本文为阅读[source](https://makefiletutorial.com/#beginner-examples)所写的笔记。这里是对应的[仓库](https://github.com/marco-hmc/makefile_tutorial)。
>
> 估计阅读耗时：1.5h

### 1. Getting started

* **什么是gcc？**

  gcc是c语言编译器，随着近些年的发展，还可以处理c++/GO/Objective-C等多种语言，编译器即为将用高级语言写好的代码，转换成机器能运行读懂的二进制指令，从而从能让计算机按照我们的设想运行。

* **还有必要学gcc吗？**

  gcc作为c语言最常用的编译器，只要C语言还有人用，gcc就有其生命力。但诚然，随着技术的发展，笔者也认为gcc在实际应用可能有点过时了，总会有很多方法避免使用gcc。但了解其基本用法，有助于我们学习编译原理以及使用现代的CMake等构建工具。

* **除了gcc之外，还有什么编译器？**

  gcc/clang/msvc这些为主流的C语言编译器，但历史上还出现过如Turbo C/C++等当今主要存在于大学老师课件的编译器。感兴趣的可以点击[这里](https://www.zhihu.com/question/39661628)看c/c++编译器的历史。
  
  

### 2. Examples

#### 2.1 Demo0 - 编译器完整流程

* **Task**

  单文件的编译。

* **Prerequisites knowledge**

  | 命令 |        作用        |
  | :--: | :----------------: |
  | `-E` |    生成调试信息    |
  | `-S` |    预处理和编译    |
  | `-c` | 预处理、编译和汇编 |

------



#### 2.2 Demo1 - 单文件

* **Task**

  单命令，快速完成编译

* **Prerequisites knowledge**

  |  命令   |            作用            |
  | :-----: | :------------------------: |
  |  `-o`   |  预处理、编译、汇编和链接  |
  |  `-g`   |        生成调试信息        |
  | `-Wall` |        生成警告信息        |
  | `-std`  | 选定c/c++版本，如c11,c98等 |

------



#### 2.3 Demo2 - 生成静态链接库

* **Task**

  生成静态链接库

* **Prerequisites knowledge**

  |   命令    |                             作用                             |
  | :-------: | :----------------------------------------------------------: |
  | `-ar rcs` | -ar为打包 常与rcs配合使用 生成静态链接库， 进一步用法，在此略去 |

------



#### 2.3 Demo3 - 调用静态库

* **Task**

  调用静态链接库

* **Prerequisites knowledge**

  | 命令 |                             作用                             |
  | :--: | :----------------------------------------------------------: |
  | `-L` |                      指定静态链接库路径                      |
  | `-l` | 指定静态链接库名称，内置有搜索规则，一般生成的静态链接库需要命名为libxxx.a，因此只需要用-lxxx即可，空格往往省略 |

  

------



#### 2.4 Demo4 - 生成动态链接库

* **Task**

  生成静态链接库

* **Prerequisites knowledge**

  |          命令          |          作用           |
  | :--------------------: | :---------------------: |
  | `-fpic -shared xxx.c ` | 将`xxx.c`生成动态链接库 |

------



#### 2.5 Demo5 - 调用动态库

* **Task**

  调用静态链接库

* **Prerequisites knowledge**

  |           命令           |                        作用                        |
  | :----------------------: | :------------------------------------------------: |
  | `gcc *.c libxxx.so 即可` |        动态链接库，不需特别声明，直接用就好        |
  |      `ldd main.out`      | 如果无法找到动态联机库，可以执行这个查看动态链接库 |

* 运行由动态链接库生成的可执行文件时，必须确保程序在运行时可以找到这个动态链接库。常用的解决方案有如下几种：

  - 将链接库文件移动到标准库目录下（例如 /usr/lib、/usr/lib64、/lib、/lib64）；
  - 在终端输入`export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:xxx`，其中 xxx 为动态链接库文件的绝对存储路径（此方式仅在当前终端有效，关闭终端后无效）；
  - 修改~/.bashrc 或~/.bash_profile 文件，即在文件最后一行添加`export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:xxx`（xxx 为动态库文件的绝对存储路径）。保存之后，执行`source .bashrc`指令（此方式仅对当前登陆用户有效）。

### 3. Conclusion

​	常见的用法主要为`gcc -o`以及生成静态库和动态库等，学习本章内容有助于在应用角度上，理解程序运行过程需要哪些步骤。而且也有助于vs code等编辑器进行相关编程语言的配置。